'use strict';

$(window).on("load", function () {
    $('.loader').addClass('hide').fadeOut(1500);
    $('.home').addClass('open');
    $('body').addClass('load');
});

window.onload = function () {
    if (document.getElementById('video')) {
        document.getElementById('video').innerHTML = '<video id="video-you" preload="metadata" loop width="100%" autoplay\n' + '               muted>\n' + '            <source src="static/video_bg.mp4" type="video/mp4"></source>\n' + '        </video>';
    }
};

$(document).ready(function () {

    $('.home__more').click(function () {
        $('.home__grid-right').addClass('hide');
        $('.about').addClass('open');
        $('.scroller').addClass('hide');
        $('.fixed__btn').addClass('hide');
        $('.send').removeClass('open');
    });

    $('.about__close').click(function () {
        $('.home__grid-right').removeClass('hide');
        $('.about').removeClass('open');
        $('.scroller').removeClass('hide');
        $('.fixed__btn').removeClass('hide');
        $('.request__helper').removeClass('hide');
    });
    function setDelay(items, animation) {
        items.animated(animation);
        items.each(function (index) {
            $(this).css({
                'animation-delay': 0.1 + index * 0.1 + 's'
            });
        });
    }

    function scrollBg(val) {
        $('#video').css({
            'transform': 'translateY(' + val + 'vh)'
        });
    }

    // $('#cloud_tags').tagcanvas({
    //     textColour : '#ffffff',
    //     outlineThickness : 1,
    //     maxSpeed : 0.03,
    //     depth : 0.75
    // });


    //position fucking YOU
    (function () {
        $('.sidebar__you').css({
            'top': $('.home__left-preview img')[0].y + 'px'
        });
    })($);

    var word_list = [{ text: "JS", weight: 13 }, { text: "Ruby bundler", weight: 5.5 }, { text: "Gulp", weight: 4 }, { text: "Webpack", weight: 5.4 }, { text: "Composer", weight: 1 }, { text: "Redis", weight: 2 }, { text: "FB API", weight: 1 }, { text: "Gitlab CI", weight: 3 }, { text: "Vagrant", weight: 2 }, { text: "SASS", weight: 6 }, { text: "Bitrix", weight: 4 }, { text: "LESS", weight: 3 }, { text: "Bootstrap", weight: 5 }, { text: "Wordpress", weight: 5 }, { text: "PHP", weight: 10 }, { text: "MongoDB", weight: 4 }, { text: "Laravel", weight: 9 }, { text: "Vue", weight: 9 }, { text: "Joomla", weight: 2 }, { text: "Objective C", weight: 2 }, { text: "Yii", weight: 2 }, { text: "Linux", weight: 2 }, { text: "Jira", weight: 4 }, { text: "Angular", weight: 7 }, { text: "Jquery", weight: 6 }, { text: "EmberJS", weight: 2 }, { text: "Opencart", weight: 2 }, { text: "Bower", weight: 2 }, { text: "Nginx", weight: 4 }, { text: "FQL", weight: 2 }, { text: "Apache", weight: 4 }, { text: "Memcashed", weight: 1 }, { text: "Npm", weight: 6 }, { text: "Basecamp", weight: 1 }, { text: "Aurelia", weight: 1 }, { text: "Kotlin", weight: 1 }, { text: "Codeigniter", weight: 1 }, { text: "ModX", weight: 1 }, { text: "CoffeeScript", weight: 1 }, { text: "Sphinx", weight: 1 }, { text: "Python", weight: 3 }];
    $(function () {
        $("#cloud_tages").jQCloud(word_list, {
            removeOverflowing: true
        });
    });

    function initFullpage() {
        $('#fullpage').fullpage({
            anchors: ['page_1', 'page_2', 'page_3', 'page_4', 'page_5', 'page_6'],
            scrollingSpeed: 800,
            scrollBar: false,
            css3: true,
            easing: 'easeInOutCubic',
            easingcss3: 'ease',
            onLeave: function onLeave(origin, destination, direction) {
                switch (destination) {
                    case 1:
                        {
                            scrollBg(0);
                            break;
                        }
                    case 2:
                        {
                            $('.task').addClass('scrolled');
                            scrollBg(-20);
                            break;
                        }
                    case 3:
                        {
                            $('.cloud').addClass('scrolled');
                            scrollBg(-40);
                            break;
                        }
                    case 4:
                        {
                            $('.map').addClass('scrolled');
                            scrollBg(-60);
                            break;
                        }
                    case 5:
                        {
                            $('.portfolio').addClass('scrolled');
                            scrollBg(-80);
                            break;
                        }
                    case 6:
                        {
                            $('.contacts').addClass('scrolled');
                            break;
                        }
                }
                if (origin === 5) {
                    $('.portfolioOpen').removeClass('open');
                    $('.portfolio__item').removeClass('active');
                } else {}
                if (destination <= 4) {
                    $('.scroller').addClass('hide');
                    $('.scroller').removeClass('hidden');
                } else {
                    $('.scroller').addClass('hidden');
                }
                $.fn.fullpage.setMouseWheelScrolling(true);
                $('.home__grid-right').removeClass('hide');
                $('.about').removeClass('open');
                $('.task__tabs').removeClass('open');
                $('.fixed__btn').removeClass('hide');
                $('.task').removeClass('open');
                $('.task').removeClass('active_n');
                setTimeout(function () {
                    $('.task__tabs-list li').removeClass('active');
                    $('.task__tabs-item').removeClass('active');
                }, 300);
                if (destination !== 1) {
                    $('.sidebar__you').fadeOut();
                } else {
                    $('.sidebar__you').fadeIn();
                }
                $('.send').removeClass('open');
                $('.sidebar').removeClass('open');
                $('.request__helper ').removeClass('hide');
                $('.header__burger').removeClass('active');
                var $th = $(this);
                $('.section').removeClass('up__elem').removeClass('down__elem');
                if (origin && destination) {
                    $('.anchors__list li').each(function (index, elem) {
                        $(elem).removeClass('active');
                        if (destination === index + 1) {
                            $(elem).addClass('active');
                        }
                    });
                } else {
                    $('.anchors__list li:first-child').addClass('active');
                }
                if (direction === 'up') {
                    $th.addClass('up__elem');
                } else {
                    $th.next().addClass('down__elem');
                }
                if (destination !== 1) {
                    $('.header__wrap').addClass('header__border');
                    $('.header__logo').removeClass('hide');
                } else {
                    $('.header__wrap').removeClass('header__border');
                    $('.header__logo').addClass('hide');
                }

                $('.fixed__btn').removeClass('hide');
            },
            afterLoad: function afterLoad(origin, destination, direction) {
                $('.scroller').removeClass('hide');
            },
            afterRender: function afterRender() {
                $('.anchors__list li:first-child').addClass('active');
            },
            afterResize: function afterResize(width, height) {},
            afterResponsive: function afterResponsive(isResponsive) {},
            afterSlideLoad: function afterSlideLoad(section, origin, destination, direction) {},
            onSlideLeave: function onSlideLeave(section, origin, destination, direction) {}

        });
    }
    initFullpage();
    $('.header__logo').click(function () {
        $.fn.fullpage.moveTo(1);
    });

    $('.about, .portfolioOpen, .send').hover(function () {
        $.fn.fullpage.setMouseWheelScrolling(false);
    }, function () {
        $.fn.fullpage.setMouseWheelScrolling(true);
    });

    $('.map__left-item').hover(function (e) {
        var $th = $(e.delegateTarget);
        $th.addClass('active');
        var indexElem = $th.index();
        $(' .map__right-item').each(function (index, elem) {
            if (index === indexElem) {
                $(elem).addClass('active');
            }
        });
    }, function (e) {
        var $th = $(e.delegateTarget);
        $th.removeClass('active');
        var index = $th.index();
        $(' .map__right-item').removeClass('active');
    });
    $('.map__right-item').hover(function (e) {
        var $th = $(e.delegateTarget);
        $th.addClass('active');
        var indexElem = $th.index();
        $('.map__left-item').each(function (index, elem) {
            if (index === indexElem) {
                $(elem).addClass('active');
            }
        });
    }, function (e) {
        var $th = $(e.delegateTarget);
        $th.removeClass('active');
        var index = $th.index();
        $('.map__left-item').removeClass('active');
    });

    $('.fixed__btn').click(function (e) {
        var $th = $(e.delegateTarget);
        $th.addClass('hide');
    });

    //task tabs
    $('ul.task__tabs-list').on('click', 'li:not(.active)', function () {
        $(this).addClass('active').siblings().removeClass('active').parents('div.task__tabs-wrap').find('div.task__tabs-item').removeClass('active').eq($(this).index()).addClass('active');
    });

    // $('ul.task__tabs-list').on('click', 'li:not(.active)', function() {
    //     const indexElem = $(this).index();
    //     $('.task__tabs-item').removeClass('active');
    //     $(this).addClass('active').siblings().removeClass('active');
    //     console.log($(this).parents('.task__tabs-left').find('.task__tabs-content'));
    //     $(this).parents('.task__tabs-left').find('.task__tabs-item').each((index, elem) => {
    //         $(elem).eq(indexElem).addClass('active');
    //     });
    //
    // });


    // main navigation drop second menu
    $('.select__head').click(function () {
        $('.select__wrap').show(100);
        $('.select__head').addClass('active');
    });
    $('.select__wrap').on('click', 'li', function () {
        $('.select__head').removeClass('active');
        var val = $(this).find('a').text();
        var flagVal = $(this).find('a img').attr('src');
        var $parent = $(this).parents('.select__lang');
        $parent.find('.select__current').removeClass('active');
        $('.select__current img').attr('src', flagVal);
        $('.select__current span').text(val);
        $parent.find('.select__wrap').slideUp(100);
    });

    $(document).click(function (e) {
        var $headerSerch = $('.select__wrap');
        var elem = $('.select__lang');
        if (elem.has(e.target).length === 0) {
            elem.find('.select__head').removeClass('active');
            $headerSerch.fadeOut(200);
        }
    });

    //close alert
    $('.alert__close, .alert__bg').click(function (e) {
        var $th = $(e.delegateTarget);
        $th.parents('.alert').fadeOut();
        $th.parents('.alert').find('.alert__content').removeClass('open');
    });

    //sliders
    //animation
    (function ($) {
        $.fn.animated = function (inEffect) {
            $(this).each(function () {
                var ths = $(this);
                ths.css("opacity", "0").addClass("animated").waypoint(function (dir) {
                    if (dir === "down") {
                        ths.addClass(inEffect).css("opacity", "1");
                    }
                }, {
                    offset: "80%"
                });
            });
        };
    })(jQuery);

    //start animation

    setTimeout(function () {
        $('.loader_').fadeOut();
        $('.wrapper').addClass('load');
        $('.load .header__container').animated('slide_top_s');
        $('.load .home__left').animated('slide_left_s');
        $('.load .home__right').animated('slide_right_s');
    }, 3000);

    //deleted animation for mobile
    var isMobile = {
        Android: function Android() {
            return navigator.userAgent.match(/Android/i) ? true : false;
        },
        BlackBerry: function BlackBerry() {
            return navigator.userAgent.match(/BlackBerry/i) ? true : false;
        },
        iOS: function iOS() {
            return navigator.userAgent.match(/iPhone|iPad|iPod/i) ? true : false;
        },
        Windows: function Windows() {
            return navigator.userAgent.match(/IEMobile/i) ? true : false;
        },
        any: function any() {
            return isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Windows();
        }
    };

    var currentBrowser = {
        Android: function Android() {
            return navigator.userAgent.match(/Android/i) ? true : false;
        },
        BlackBerry: function BlackBerry() {
            return navigator.userAgent.match(/BlackBerry/i) ? true : false;
        },
        iOS: function iOS() {
            return navigator.userAgent.match(/iPhone|iPad|iPod/i) ? true : false;
        },
        Windows: function Windows() {
            return navigator.userAgent.match(/IEMobile/i) ? true : false;
        },
        any: function any() {
            return isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Windows();
        }
    };

    if (!isMobile.any()) {
        $('body').addClass('no-touch');
        $('.info__top-left').animated('slide_left_s');
        setDelay($('.faq__colum:last-child .faq__item'), 'slide_right_s');
    }

    //burger
    $('.header__burger').click(function () {
        $('.header__burger').toggleClass('active');
        $('.sidebar').toggleClass('open');

        if ($(this).hasClass('active')) {
            $('.header__logo').addClass('hide');
        } else if ($(this).hasClass('active') && $('.fp-viewing-page_1')) {
            $('.header__logo').removeClass('hide');
        }
    });

    $('.mob__header-bg').click(function () {
        $('.burger__line').removeClass('active-b');
        $('.mob__header-wrap, .mob__header-bg').removeClass('active');
        $('body').removeClass('open');
    });

    $('.send__helper').click(function (e) {
        var $th = $(e.delegateTarget);
        $('.send').addClass('open');
        $('.request__helper').addClass('hide');
    });
    $('.send__close').click(function (e) {
        var $th = $(e.delegateTarget);
        $('.request__helper').removeClass('hide');
        $('.send').removeClass('open');
        $('.fixed__btn').removeClass('hide');
    });

    //validation contacts form
    var fakeAPI = 'https://jsonplaceholder.typicode.com/posts';
    var required = $('#buy__form').data('required');
    var validEmail = $('#buy__form').data('email');
    var checkboxMsg = $('#buy__form').data('checkbox');
    $('#send__message').validate({
        // ignore: [],
        errorElement: 'span',
        rules: {
            'name': {
                required: true
            },
            'phone': {
                required: true
            },
            'email': {
                required: true,
                email: true
            },
            'theme': {
                required: true
            },
            'message': {
                required: true
            }
        },
        messages: {
            'name': {
                required: required
            },
            'phone': {
                required: required
            },
            'email': {
                required: required,
                email: validEmail
            },
            'theme': {
                required: required
            },
            'message': {
                required: required
            }
        },
        submitHandler: function submitHandler(form) {
            if ($(form).valid) {
                $('.loader').show();
            }
            $.ajax({
                type: 'post',
                url: fakeAPI,
                // url: 'contact.php',
                data: $(form).serialize()
            }).done(function (response) {
                $('.loader').hide();
                $('#alert_thanks').fadeIn().find('.alert__content').addClass('open');
                $('#buy__form').trigger('reset');
            }).fail(function (response) {
                $('.loader').hide();
                $('#server_error').fadeIn().find('.alert__content').addClass('open');
            });
            return false;
        },
        // add error from parents block
        highlight: function highlight(element) {
            $(element).parent().addClass('error').removeClass('valid');
        },
        unhighlight: function unhighlight(element) {
            $(element).parent().addClass('valid').removeClass('error');
        }
    });

    //popup
    $('.open__popup').click(function (e) {
        e.preventDefault();
        var $th = $(e.delegateTarget);
        var thData = $th.attr('data-popup');
        $('body').addClass('open');
        $('.hidden .popup').each(function (index, elem) {
            if ($(elem).attr('id') === thData) {
                $(elem).fadeIn();
            }
        });
    });
    //popup close
    $('.popup__close, .popup__bg').click(function (e) {
        var $th = $(e.delegateTarget);
        $th.parents('.popup').fadeOut();
        $('body').removeClass('open');
    });

    function scrollToAnchor(aid) {
        var aTag = $("a[name='" + aid + "']");
        $('html,body').animate({ scrollTop: aTag.offset().top }, 'slow');
    }

    //anchors

    $('.home__scroll a, .get__started, .header__menu li a').click(function (e) {
        e.preventDefault();
        var $th = $(e.delegateTarget);
        var id = $th.attr('href');
        var top = $(id).offset().top;
        $('body,html').animate({ scrollTop: top }, 1000);
    });
    //nice select
    $('#buy__form_country').niceSelect();

    $('.nice-select .option').click(function (e) {
        var $th = $(e.delegateTarget);
        var val = $th.attr('data-value');
        $('#contacts_subject').val(val);
    });

    //header
    if ($(window).width() <= 580) {
        $('.home__right iframe').appendTo('.info__top-right');
    } else {
        $('.info__top-right iframe').appendTo('.home__right');
    }

    if ($(window).width() <= 1200) {
        $('.header__bottom').appendTo('.mob__header-wrap');
        $('.header__top').appendTo('.mob__header-wrap');
    } else {
        $('.header__top').appendTo('.header__right');
        $('.header__bottom').appendTo('.header__right');
    }

    //resize adaptive
    $(window).resize(function () {
        //header
        if ($(window).width() <= 1200) {
            $('.header__bottom').appendTo('.mob__header-wrap');
            $('.header__top').appendTo('.mob__header-wrap');
        } else {
            $('.header__top').appendTo('.header__right');
            $('.header__bottom').appendTo('.header__right');
        }
        //home video
        if ($(window).width() <= 580) {
            $('.home__right iframe').appendTo('.info__top-right');
        } else {
            $('.info__top-right iframe').appendTo('.home__right');
        }
    });

    //sync slider
    //faq
    $('.faq__item-head').click(function (e) {
        var $th = $(e.delegateTarget);
        var element = $th.next();
        element.slideToggle(300);
        $('.faq__item-body:visible').not(element).slideUp(300);
        $('.faq__item-head').not($th).removeClass('active');
        $th.toggleClass('active');
    });

    $('.task__category-item').click(function (e) {
        var $th = $(e.delegateTarget);
        $('.task').addClass('open');
    });

    $('.task__category-item').click(function (e) {
        var $th = $(e.delegateTarget);
        $('.task__tabs').addClass('open');
        $('.task').addClass('active_n');
        $('.scroller').addClass('hide');
        $('.task').addClass('open');
        $('.fixed__btn').addClass('hide');
        var currentElem = $th.index();
        $('.request__helper').removeClass('hide');
        $('.send').removeClass('open');

        $('.task__tabs-list li').each(function (index, elem) {
            if (index === currentElem) {
                $(elem).addClass('active');
            }
        });
        $('.task__tabs-item').each(function (index, elem) {
            if (index === currentElem) {
                $(elem).addClass('active');
            }
        });
    });
    $('.task__tabs-right').hover(function () {
        $.fn.fullpage.setMouseWheelScrolling(false);
    }, function () {
        $.fn.fullpage.setMouseWheelScrolling(true);
    });

    $('.task__back').click(function (e) {
        $('.task').removeClass('active_n');
        $('.task__tabs').removeClass('open');
        $('.scroller').removeClass('hide');
        $('.fixed__btn').removeClass('hide');
        $('.task').removeClass('open');
        setTimeout(function () {
            $('.task__tabs-list li').removeClass('active');
            $('.task__tabs-item').removeClass('active');
        }, 300);
    });

    $('.portfolioOpen .send__close').click(function () {
        $('.portfolioOpen').removeClass('open');
        $('.portfolio__item').removeClass('active');
    });

    $('.portfolio__item').click(function (e) {
        var $th = $(e.delegateTarget);
        $('.portfolio__item').removeClass('active');
        //wtf $
        if ($th.find('.portfolio__hidden').hasClass('portfolio__hidden')) {
            $th.addClass('active');
            var descClone = $th.find('.portfolio__hidden-helper').clone();
            var imgSrc = $th.find('img').attr('src');
            $('.portfolioOpen__img img').attr('src', imgSrc);
            $('.portfolioOpen__desc').html(descClone);
            $('.portfolioOpen').addClass('open');
        }
    });
    if ($(window).width() <= 1200) {}
});

// preload images